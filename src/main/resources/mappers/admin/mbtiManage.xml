<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="LacunaMatata.Lacuna.repository.admin.MbtiManageMapper">
    <resultMap id="mbtiCategoryResultMap" type="LacunaMatata.Lacuna.entity.mbti.MbtiCategory">
        <id property="mbtiCategoryId" column="mbti_category_id" />
        <result property="mbtiCategoryRegisterId" column="mbti_category_register_id" />
        <result property="mbtiCategoryName" column="mbti_category_name" />
        <result property="mbtiCategoryTitle" column="mbti_category_title" />
        <result property="mbtiCategoryDescription" column="mbti_category_description" />
        <result property="mbtiCategoryImg" column="mbti_category_img" />
        <result property="createDate" column="create_date" />
        <result property="updateDate" column="update_date" />
        <association property="user" resultMap="userResultMap" />
    </resultMap>
    <resultMap id="userResultMap" type="LacunaMatata.Lacuna.entity.user.User">
        <id property="userId" column="user_id" />
        <result property="name" column="name" />
    </resultMap>
    <insert id="registerMbtiCategory" useGeneratedKeys="true" keyProperty="mbtiCategoryId">
        insert into tb_mbti_category
        values(
            default,
            #{mbtiCategoryRegisterId},
            #{mbtiCategoryName},
            #{mbtiCategoryTitle},
            #{mbtiCategoryDescription},
            #{mbtiCategoryImg},
            now(),
            now()
        )
    </insert>
    <insert id="registerMbtiResult">
        insert into tb_
    </insert>
    <update id="modifyMbtiCategory">
        update
            tb_mbti_category
        set
            mbti_category_name = #{mbtiCategoryName},
            mbti_category_title = #{mbtiCategoryTitle},
            mbti_category_description = #{mbtiCategoryDescription},
            mbti_category_img = #{mbtiCategoryImg}
        where
            mbti_category_id = #{mbtiCategoryId}
    </update>
    <update id="modifyMbtiResult">
        update
            tb_mbti_result
        set
            mbti_result_title = #{mbtiResultTitle}
            mbti_result_category_name = #{mbtiResultCategoryName}
            mbti_result_img = #{mbtiResultImg}
            mbti_result_summary = #{mbtiResultSummary}
            mbti_result_content = #{mbtiResultContent}
            mbti_result_status = #{mbtiResultStatus}
        where
            mbti_result_id = #{resultId}
    </update>
    <delete id="deleteMbtiCategory">
        delete
        from
            tb_mbti_category
        where
            mbti_category_id = #{categoryId}
    </delete>
    <delete id="deleteMbtiCategoryList">
        delete
        from
            tb_mbti_category
        where
            mbti_catedory_id in
            <foreach item="mbtiCategoryId" collection="mbtiCategoryIdList" open="(" separator="," close=")">
                #{mbtiCategoryId}
            </foreach>
    </delete>
    <delete id="deleteMbtiQuestion">
        delete
        from
            tb_mbti_result
        where
            mbti_result_title = #{mbtiResultTitle}
            mbti_result_category_name = #{mbtiResultCategoryName}
            mbti_result_img = #{mbtiResultImg}
            mbti_result_summary = #{mbtiResultSummary}
            mbti_result_content = #{mbtiResultContent}
            mbti_result_status = #{mbtiResultStatus}
    </delete>
    <delete id="deleteMbtiResult">
        delete
        from
            tb_mbti_result
        where
            mbti_result_id = #{resultId}
    </delete>

    <select id="getMbtiCategoryList" resultMap="mbtiCategoryResultMap">
        select
            mc.mbti_category_id,
            mc.mbti_category_register_id,
            mc.mbti_category_name,
            mc.mbti_category_title,
            mc.mbti_category_description,
            mc.mbti_category_img,
            mc.create_date,
            mc.update_date,
            u.user_id,
            u.name
        from
            tb_mbti_category mc
            left outer join tb_user u on(u.user_id = mc.mbti_category_register_id)
        limit
            #{startIndex}, #{limit}
    </select>
    <select id="findMbtiCategoryByCategoryId" resultMap="mbtiCategoryResultMap">
        select
            *
        from
            tb_mbti_category
        where
            mbti_category_id = #{categoryId}
    </select>
    <select id="getMbtiQuestionList" resultMap="mbtiResultMap">
        select
            mbti_id,
            mbti_code,
            mbti_category_id,
            mbti_register_id,
            mbti_title,
            mbti_img,
            create_date,
            update_date,
            (select u.name
            from tb_user
            where u.user_id = m.register_id) as registerName,
            (select mc.mbti_category_name
            from tb_mbti_category
            where m.mbti_category_id = mc.mbti_category_id)
        from
            tb_mbti m
        where
            1 = 1
            <if test="option != null and option != ''">
                and mc.mbti_category_name = #{option}
            </if>
            <if test="search != null and option != ''">
                and
            </if>
    </select>
</mapper>